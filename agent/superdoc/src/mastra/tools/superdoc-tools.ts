import { createTool } from '@mastra/core/tools';
import { z } from 'zod';
import { AxiosClient } from '../utils/axios-client';

const links = [{"href":"/docs","text":"DOCS"},{"href":"/docs/guides/getting-started","text":"Start"},{"href":"/docs","text":"DOCS"},{"href":"/docs/reference/javascript/introduction","text":"Introduction"},{"href":"/docs/reference/javascript/installing","text":"Installing"},{"href":"/docs/reference/javascript/initializing","text":"Initializing"},{"href":"/docs/reference/javascript/typescript-support","text":"TypeScript support"},{"href":"/docs/reference/javascript/select","text":"Fetch data"},{"href":"/docs/reference/javascript/insert","text":"Insert data"},{"href":"/docs/reference/javascript/update","text":"Update data"},{"href":"/docs/reference/javascript/upsert","text":"Upsert data"},{"href":"/docs/reference/javascript/delete","text":"Delete data"},{"href":"/docs/reference/javascript/rpc","text":"Call a Postgres function"},{"href":"/docs/reference/javascript/auth-api","text":"Overview"},{"href":"/docs/reference/javascript/auth-signup","text":"Create a new user"},{"href":"/docs/reference/javascript/auth-onauthstatechange","text":"Listen to auth events"},{"href":"/docs/reference/javascript/auth-signinanonymously","text":"Create an anonymous user"},{"href":"/docs/reference/javascript/auth-signinwithpassword","text":"Sign in a user"},{"href":"/docs/reference/javascript/auth-signinwithidtoken","text":"Sign in with ID token (native sign-in)"},{"href":"/docs/reference/javascript/auth-signinwithotp","text":"Sign in a user through OTP"},{"href":"/docs/reference/javascript/auth-signinwithoauth","text":"Sign in a user through OAuth"},{"href":"/docs/reference/javascript/auth-signinwithsso","text":"Sign in a user through SSO"},{"href":"/docs/reference/javascript/auth-signinwithweb3","text":"Sign in a user through Web3 (Solana, Ethereum)"},{"href":"/docs/reference/javascript/auth-getclaims","text":"Get user claims from verified JWT"},{"href":"/docs/reference/javascript/auth-signout","text":"Sign out a user"},{"href":"/docs/reference/javascript/auth-resetpasswordforemail","text":"Send a password reset request"},{"href":"/docs/reference/javascript/auth-verifyotp","text":"Verify and log in through OTP"},{"href":"/docs/reference/javascript/auth-getsession","text":"Retrieve a session"},{"href":"/docs/reference/javascript/auth-refreshsession","text":"Retrieve a new session"},{"href":"/docs/reference/javascript/auth-getuser","text":"Retrieve a user"},{"href":"/docs/reference/javascript/auth-updateuser","text":"Update a user"},{"href":"/docs/reference/javascript/auth-getuseridentities","text":"Retrieve identities linked to a user"},{"href":"/docs/reference/javascript/auth-linkidentity","text":"Link an identity to a user"},{"href":"/docs/reference/javascript/auth-unlinkidentity","text":"Unlink an identity from a user"},{"href":"/docs/reference/javascript/auth-reauthentication","text":"Send a password reauthentication nonce"},{"href":"/docs/reference/javascript/auth-resend","text":"Resend an OTP"},{"href":"/docs/reference/javascript/auth-setsession","text":"Set the session data"},{"href":"/docs/reference/javascript/auth-exchangecodeforsession","text":"Exchange an auth code for a session"},{"href":"/docs/reference/javascript/auth-startautorefresh","text":"Start auto-refresh session (non-browser)"},{"href":"/docs/reference/javascript/auth-stopautorefresh","text":"Stop auto-refresh session (non-browser)"},{"href":"/docs/reference/javascript/functions-invoke","text":"Invokes a Supabase Edge Function."},{"href":"/docs/reference/javascript/subscribe","text":"Subscribe to channel"},{"href":"/docs/reference/javascript/removechannel","text":"Unsubscribe from a channel"},{"href":"/docs/reference/javascript/removeallchannels","text":"Unsubscribe from all channels"},{"href":"/docs/reference/javascript/getchannels","text":"Retrieve all channels"},{"href":"/docs/reference/javascript/broadcastmessage","text":"Broadcast a message"},{"href":"/docs/reference/javascript/storage-createbucket","text":"Create a bucket"},{"href":"/docs/reference/javascript/storage-getbucket","text":"Retrieve a bucket"},{"href":"/docs/reference/javascript/storage-listbuckets","text":"List all buckets"},{"href":"/docs/reference/javascript/storage-updatebucket","text":"Update a bucket"},{"href":"/docs/reference/javascript/storage-deletebucket","text":"Delete a bucket"},{"href":"/docs/reference/javascript/storage-emptybucket","text":"Empty a bucket"},{"href":"/docs/reference/javascript/storage-from-upload","text":"Upload a file"},{"href":"/docs/reference/javascript/storage-from-download","text":"Download a file"},{"href":"/docs/reference/javascript/storage-from-list","text":"List all files in a bucket"},{"href":"/docs/reference/javascript/storage-from-update","text":"Replace an existing file"},{"href":"/docs/reference/javascript/storage-from-move","text":"Move an existing file"},{"href":"/docs/reference/javascript/storage-from-copy","text":"Copy an existing file"},{"href":"/docs/reference/javascript/storage-from-remove","text":"Delete files in a bucket"},{"href":"/docs/reference/javascript/storage-from-createsignedurl","text":"Create a signed URL"},{"href":"/docs/reference/javascript/storage-from-createsignedurls","text":"Create signed URLs"},{"href":"/docs/reference/javascript/storage-from-createsigneduploadurl","text":"Create signed upload URL"},{"href":"/docs/reference/javascript/storage-from-uploadtosignedurl","text":"Upload to a signed URL"},{"href":"/docs/reference/javascript/storage-from-getpublicurl","text":"Retrieve public URL"},{"href":"/docs","text":"DOCS"},{"href":"/docs/guides/getting-started","text":"Start"},{"href":"/docs","text":"DOCS"},{"href":"https://github.com/supabase/supabase-js","text":"View on GitHub"},{"href":"/docs/guides/api/sql-to-rest","text":"SQL to REST API translator"},{"href":"#install-as-package","text":"#"},{"href":"#install-via-cdn","text":"#"},{"href":"#use-at-runtime-in-deno","text":"#"},{"href":"https://jsr.io/@supabase/supabase-js","text":"JSR"},{"href":"https://www.postgresql.org/docs/current/ddl-generated-columns.html","text":"generated columns"},{"href":"#generating-typescript-types","text":"#"},{"href":"/docs/reference/cli/supabase-gen-types","text":"generate the types"},{"href":"https://supabase.com/dashboard/project/_/api?page=tables-intro","text":"from the dashboard"},{"href":"#using-typescript-type-definitions","text":"#"},{"href":"#helper-types-for-tables-and-joins","text":"#"},{"href":"https://github.com/sindresorhus/type-fest","text":"type-fest"},{"href":"#response-types-for-complex-queries","text":"#"},{"href":"/dashboard/project/_/settings/api","text":"API settings"},{"href":"/docs/reference/javascript/using-filters","text":"Filters"},{"href":"/docs/reference/javascript/using-modifiers","text":"Modifiers"},{"href":"/docs/guides/platform","text":"Supabase Platform"},{"href":"https://github.com/supabase/supabase/issues/5465","text":"should be avoided as a column name"},{"href":"/docs/reference/javascript/using-filters","text":"Filters"},{"href":"/docs/reference/javascript/using-filters","text":"filters"},{"href":"/docs/learn/auth-deep-dive/auth-row-level-security","text":"RLS"},{"href":"/docs/guides/platform/read-replicas","text":"Read Replicas"},{"href":"/docs/guides/database/full-text-search","text":"Postgres full text search"},{"href":"https://postgrest.org/en/stable/api.html#operators","text":"PostgREST syntax"},{"href":"https://postgrest.org/en/stable/api.html#operators","text":"PostgREST syntax"},{"href":"https://postgrest.org/en/stable/api.html#operators","text":"PostgREST syntax"},{"href":"https://supabase.com/docs/guides/database/debugging-performance#enabling-explain","text":"db_plan_enabled"},{"href":"https://www.postgresql.org/docs/current/sql-explain.html","text":"Postgres EXPLAIN execution plan"},{"href":"/docs/guides/database/debugging-performance","text":"Performance Debugging Guide"},{"href":"https://github.com/supabase/gotrue-js/blob/master/src/lib/types.ts#L1027","text":"this interface"},{"href":"/docs/guides/platform/going-into-prod#auth-rate-limits","text":"rate limits"},{"href":"/dashboard/project/_/settings/auth","text":"your project's auth settings"},{"href":"/dashboard/project/_/auth/providers","text":"your project"},{"href":"/docs/guides/auth/redirect-urls#use-wildcards-in-redirect-urls","text":"SITE_URL"},{"href":"/dashboard/project/_/auth/url-configuration","text":"your project"},{"href":"/dashboard/project/_/auth/providers","text":"your project"},{"href":"/docs/reference/javascript/auth-getuser","text":"getUser()"},{"href":"/docs/guides/auth/sessions","text":"User Sessions"},{"href":"/docs/guides/auth/passwords#resetting-a-users-password-forgot-password","text":"reset their password"},{"href":"https://developers.google.com/identity/gsi/web/guides/display-google-one-tap","text":"One Tap"},{"href":"https://developers.google.com/identity/gsi/web/guides/automatic-sign-in-sign-out","text":"Automatic sign-in"},{"href":"/docs/guides/auth/redirect-urls#use-wildcards-in-redirect-urls","text":"SITE_URL"},{"href":"/docs/guides/auth/redirect-urls#use-wildcards-in-redirect-urls","text":"redirect URLs and wildcards"},{"href":"/dashboard/project/_/auth/templates","text":"modify the magic link email template"},{"href":"/docs/guides/auth/phone-login?showSMSProvider=Twilio","text":"Twilio Phone Auth Guide"},{"href":"/docs/guides/auth#configure-third-party-providers","text":"Social Login (OAuth) providers"},{"href":"/docs/guides/auth/sso/auth-sso-saml#managing-saml-20-connections","text":"establish a connection"},{"href":"/docs/reference/cli/supabase-sso","text":"CLI commands"},{"href":"/docs/guides/auth/auth-web3#potential-for-abuse","text":"potential for abuse"},{"href":"/docs/guides/auth/sessions#access-token-jwt-claims","text":"access token"},{"href":"/docs/guides/auth/jwts","text":"JSON Web Token (JWT)"},{"href":"https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API","text":"WebCrypto API"},{"href":"/docs/guides/auth/auth-hooks/custom-access-token-hook","text":"Custom Access Token Hook"},{"href":"/docs/reference/javascript/auth-updateuser","text":"updateUser()"},{"href":"/docs/reference/javascript/auth-onauthstatechange","text":"onAuthStateChange()"},{"href":"/docs/guides/auth/redirect-urls#use-wildcards-in-redirect-urls","text":"redirect URLs and wildcards"},{"href":"/docs/guides/auth/auth-email-templates","text":"email templates"},{"href":"/docs/guides/auth/server-side/email-based-auth-with-pkce-flow-for-ssr","text":"this guide"},{"href":"/docs/guides/auth/signing-keys","text":"asymmetric JWT signing keys"},{"href":"/docs/guides/auth/sessions","text":"user session"},{"href":"https://developer.mozilla.org/en-US/docs/Web/API/LockManager","text":"LockManager"},{"href":"/dashboard/project/_/auth/providers","text":"email auth provider settings"},{"href":"/dashboard/project/_/settings/auth","text":"project's authentication settings"},{"href":"/dashboard/project/_/settings/auth","text":"project's authentication settings"},{"href":"/dashboard/project/_/auth/providers","text":"project's email provider settings"},{"href":"https://supabase.com/docs/guides/auth/auth-mfa#overview","text":"in the MFA guide"},{"href":"/docs/reference/javascript/auth-mfa-challenge","text":"mfa.challenge()"},{"href":"/docs/reference/javascript/auth-mfa-verify","text":"mfa.verify()"},{"href":"/docs/reference/javascript/auth-mfa-challengeandverify","text":"mfa.challengeAndVerify()"},{"href":"/docs/reference/javascript/auth-mfa-enroll","text":"enrolled factor"},{"href":"/docs/reference/javascript/auth-mfa-verify","text":"mfa.verify()"},{"href":"/docs/reference/javascript/auth-mfa-challenge","text":"create a challenge"},{"href":"/docs/reference/javascript/auth-mfa-enroll","text":"enrolled factor"},{"href":"/docs/reference/javascript/auth-mfa-challenge","text":"mfa.challenge()"},{"href":"/docs/reference/javascript/auth-mfa-verify","text":"mfa.verify()"},{"href":"/docs/reference/javascript/auth-admin-inviteuserbyemail","text":"inviteUserByEmail()"},{"href":"/dashboard/project/_/auth/providers","text":"email auth provider settings"},{"href":"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API","text":"Fetch API"},{"href":"/docs/guides/api#realtime-api-overview","text":"replication"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"/docs/reference/javascript/storage-updatebucket","text":"updateBucket()"},{"href":"https://supabase.com/dashboard","text":"supabase.com/dashboard"},{"href":"/docs/guides/storage/security/access-control","text":"Storage guide"},{"href":"https://supabase.com/support","text":"Contact support"},{"href":"https://supabase.com/changelog","text":"See Changelog"},{"href":"https://status.supabase.com/","text":"Check system status"},{"href":"https://supabase.com/","text":"Â© Supabase Inc"},{"href":"https://github.com/supabase/supabase/blob/master/apps/docs/DEVELOPERS.md","text":"Contributing"},{"href":"https://github.com/supabase/supabase/blob/master/apps/docs/CONTRIBUTING.md","text":"Author Styleguide"},{"href":"https://supabase.com/open-source","text":"Open Source"},{"href":"https://supabase.com/supasquad","text":"SupaSquad"},{"href":"https://github.com/supabase/supabase","text":"GitHub"},{"href":"https://twitter.com/supabase","text":"Twitter"},{"href":"https://discord.supabase.com/","text":"Discord"}]

export const answer_from_doc = createTool({
    id: "answer_from_doc",
    description:`use the documentation_url, links_array and user_question to call the tool`,
    inputSchema: z.object({
        documentation_url: z.string().describe("Documentaion official url"),
        user_question: z.string().describe("user's question"),
        // links_array: z.string().describe("Array of links")
    }),    
    execute: async({ context }) => {
    const data =  await getAnswer(context.documentation_url, context.user_question, links)
        return {
            result: data
        }
    }
})

const getAnswer = async(documentation_url: string, user_question: string, links_array: any) => {
    try {
        const response = await AxiosClient.post("/get-answer-from-docs-agent", { documentation_url, user_question, links_array })
        return response.data;
    } catch (error: any) {
        throw error;
    }
}

